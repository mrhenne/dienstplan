<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dienstplan PRO - Helios Management</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body, html { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 0; width: 100%; height: 100%; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(150,150,150,0.3); border-radius: 10px; }
        .shift-cell { min-height: 44px; transition: all 0.2s ease; }
        @media print { .no-print { display: none !important; } table { font-size: 7pt; border-collapse: collapse !important; width: 100% !important; } td, th { border: 0.1pt solid #ccc !important; color: black !important; background: white !important; } }
    </style>
</head>
<body>
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const appId = typeof __app_id !== 'undefined' ? __app_id : "dienstplan-helios-pro";
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "", authDomain: "dienstplanprogramm.firebaseapp.com", projectId: "dienstplanprogramm"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const Icon = ({ name, size = 18, className = "" }) => {
            const spanRef = useRef(null);
            useEffect(() => {
                if (!spanRef.current || !window.lucide) return;
                spanRef.current.innerHTML = '';
                const i = document.createElement('i');
                i.setAttribute('data-lucide', name);
                spanRef.current.appendChild(i);
                window.lucide.createIcons({ root: spanRef.current });
                const svg = spanRef.current.querySelector('svg');
                if (svg) { svg.setAttribute('width', size); svg.setAttribute('height', size); }
            }, [name, size]);
            return <span ref={spanRef} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        const getHolidaysNRW = (year) => {
            const f = Math.floor, G = year % 19, C = f(year / 100), H = (C - f(C / 4) - f((8 * C + 13) / 25) + 19 * G + 15) % 30, 
                  I = H - f(H / 28) * (1 - f(29 / (H + 1)) * f((21 - G) / 11)), 
                  J = (year + f(year / 4) + I + 2 - C + f(C / 4)) % 7, 
                  L = I - J, month = 3 + f((L + 40) / 44), day = L + 28 - 31 * f(month / 4);
            const easter = new Date(year, month - 1, day);
            const add = (d, n) => { const r = new Date(d); r.setDate(r.getDate() + n); return r.toISOString().split('T')[0]; };
            return {
                [`${year}-01-01`]: "Neujahr", [add(easter, -2)]: "Karfreitag", [add(easter, 1)]: "Ostermontag",
                [`${year}-05-01`]: "Tag der Arbeit", [add(easter, 39)]: "Christi Himmelfahrt",
                [add(easter, 50)]: "Pfingstmontag", [add(easter, 60)]: "Fronleichnam",
                [`${year}-10-03`]: "Tag der Dt. Einheit", [`${year}-11-01`]: "Allerheiligen",
                [`${year}-12-25`]: "1. Weihnachtstag", [`${year}-12-26`]: "2. Weihnachtstag"
            };
        };

        const DEFAULT_SHIFTS = {
            FD: { label: 'Frühdienst', color: 'bg-cyan-500', textColor: 'text-cyan-950', hours: 7.7 },
            SD: { label: 'Spätdienst', color: 'bg-fuchsia-600', textColor: 'text-white', hours: 7.7 },
            ZD: { label: 'Zwischendienst', color: 'bg-indigo-600', textColor: 'text-white', hours: 7.7 },
            ND: { label: 'Nachtdienst', color: 'bg-orange-600', textColor: 'text-white', hours: 9.5 },
            U:  { label: 'Urlaub', color: 'bg-amber-400', textColor: 'text-amber-950', hours: 7.7 },
            K:  { label: 'Krank', color: 'bg-rose-600', textColor: 'text-white', hours: 7.7 },
            LT: { label: 'Leitungstag', color: 'bg-emerald-500', textColor: 'text-emerald-950', hours: 7.7 },
            X:  { label: 'Frei', color: 'bg-slate-500/20', textColor: 'text-slate-400', hours: 0 }
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [plans, setPlans] = useState({ default: { name: "Hauptplan", employees: [], roster: {}, notes: {}, shifts: DEFAULT_SHIFTS } });
            const [activePlanId, setActivePlanId] = useState('default');
            const [isDataLoaded, setIsDataLoaded] = useState(false);
            
            // UI States
            const [currentDate, setCurrentDate] = useState(new Date(2026, 3, 1));
            const [activeShift, setActiveShift] = useState('FD');
            const [isEditMode, setIsEditMode] = useState(false);
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [viewMode, setViewMode] = useState('month'); 
            const [zoom, setZoom] = useState(1);
            const [isAiModalOpen, setIsAiModalOpen] = useState(false);
            const [isPlanManagerOpen, setIsPlanManagerOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);

            // Plan-spezifische Daten (Extraktion aus aktivem Plan)
            const activePlan = plans[activePlanId] || plans['default'];
            const employees = activePlan.employees || [];
            const roster = activePlan.roster || {};
            const notes = activePlan.notes || {};
            const shifts = activePlan.shifts || DEFAULT_SHIFTS;

            useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined') await auth.signInWithCustomToken(__initial_auth_token);
                    else await auth.signInAnonymously();
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged(setUser);
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const docRef = db.doc(`artifacts/${appId}/public/data/rosterData/main`);
                const unsubscribe = docRef.onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        if (data.plans) setPlans(data.plans);
                        if (data.activePlanId) setActivePlanId(data.activePlanId);
                    }
                    setIsDataLoaded(true);
                }, () => setIsDataLoaded(true));
                return () => unsubscribe();
            }, [user]);

            useEffect(() => {
                if (!user || !isDataLoaded) return;
                const timer = setTimeout(() => {
                    setIsSyncing(true);
                    db.doc(`artifacts/${appId}/public/data/rosterData/main`).set({ plans, activePlanId, updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge: true })
                    .finally(() => setTimeout(() => setIsSyncing(false), 500));
                }, 2000);
                return () => clearTimeout(timer);
            }, [plans, activePlanId]);

            // --- Business Logic ---
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const holidays = useMemo(() => getHolidaysNRW(year), [year]);
            
            const calculateWorkingDays = (y, m) => {
                const h = getHolidaysNRW(y);
                let count = 0;
                const d = new Date(y, m, 1);
                while (d.getMonth() === m) {
                    const k = d.toISOString().split('T')[0];
                    if (d.getDay() !== 0 && d.getDay() !== 6 && !h[k]) count++;
                    d.setDate(d.getDate() + 1);
                }
                return count;
            };
            const workDays = calculateWorkingDays(year, month);
            const monthSollBase = workDays * 7.7;

            const visibleDays = useMemo(() => {
                const days = [];
                const d = new Date(year, month, 1);
                while (d.getMonth() === month) { days.push(new Date(d)); d.setDate(d.getDate() + 1); }
                return viewMode === 'month' ? days : days.slice(0, 7);
            }, [year, month, viewMode]);

            // AZG-Check: Ruhezeit, Max-Arbeit, 6-Tage
            const checkViolations = (empId, date, newShift) => {
                const dateKey = date.toISOString().split('T')[0];
                const empRost = roster[empId] || {};
                const prevDate = new Date(date); prevDate.setDate(date.getDate() - 1);
                const prevKey = prevDate.toISOString().split('T')[0];
                const prevShift = empRost[prevKey];

                const violations = [];
                // 1. Ruhezeit (ND -> FD/SD ist kritisch)
                if (prevShift === 'ND' && (newShift === 'FD' || newShift === 'SD')) {
                    violations.push("Ruhezeitverletzung: Nach ND sind 11h Ruhe Pflicht!");
                }
                // 2. 6-Tage-Regel (Quick check)
                let streak = 0;
                for(let i=1; i<7; i++) {
                    const checkDate = new Date(date); checkDate.setDate(date.getDate() - i);
                    if(empRost[checkDate.toISOString().split('T')[0]]) streak++;
                    else break;
                }
                if(streak >= 6 && newShift) violations.push("6-Tage-Regel: Mitarbeiter braucht einen freien Tag!");
                
                return violations;
            };

            const toggleShift = (empId, date) => {
                if (!isEditMode) return;
                const dateKey = date.toISOString().split('T')[0];
                const currentShift = roster[empId]?.[dateKey];
                const nextShift = currentShift === activeShift ? null : activeShift;

                setPlans(prev => ({
                    ...prev,
                    [activePlanId]: {
                        ...prev[activePlanId],
                        roster: {
                            ...(prev[activePlanId].roster || {}),
                            [empId]: { ...(prev[activePlanId].roster?.[empId] || {}), [dateKey]: nextShift }
                        }
                    }
                }));
            };

            const updateActivePlan = (updates) => {
                setPlans(prev => ({ ...prev, [activePlanId]: { ...prev[activePlanId], ...updates } }));
            };

            // --- Plan Management ---
            const createNewPlan = () => {
                const id = "plan_" + Date.now();
                setPlans(prev => ({ ...prev, [id]: { name: "Neuer Plan", employees: [...employees], roster: {}, notes: {}, shifts: { ...shifts } } }));
                setActivePlanId(id);
            };

            const duplicatePlan = (id) => {
                const newId = "copy_" + Date.now();
                setPlans(prev => ({ ...prev, [newId]: { ...prev[id], name: prev[id].name + " (Kopie)" } }));
            };

            const deletePlan = (id) => {
                if (Object.keys(plans).length <= 1) return;
                const newPlans = { ...plans };
                delete newPlans[id];
                setPlans(newPlans);
                setActivePlanId(Object.keys(newPlans)[0]);
            };

            const exportData = () => {
                const data = JSON.stringify({ plans, activePlanId }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `dienstplan_export_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsed = JSON.parse(event.target.result);
                        if (parsed.plans) {
                            setPlans(parsed.plans);
                            if (parsed.activePlanId) setActivePlanId(parsed.activePlanId);
                        }
                    } catch (err) { console.error("Import failed", err); }
                };
                reader.readAsText(file);
            };

            const themeClasses = isDarkMode ? 'bg-[#0a0f1d] text-slate-200' : 'bg-slate-50 text-slate-800';
            const cardClasses = isDarkMode ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200 shadow-sm';

            return (
                <div className={`app-container min-h-screen p-2 md:p-6 flex flex-col h-screen max-h-screen overflow-hidden transition-all ${themeClasses}`}>
                    
                    {/* TOP BAR / COMMAND CENTER */}
                    <header className={`flex items-center justify-between mb-4 p-4 rounded-[24px] no-print shrink-0 border shadow-lg ${cardClasses}`}>
                        <div className="flex items-center gap-4">
                            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                                <Icon name="shield" className="text-white" />
                            </div>
                            <div onClick={() => setIsPlanManagerOpen(true)} className="cursor-pointer group">
                                <h1 className="text-lg font-black uppercase tracking-tighter leading-none flex items-center gap-2 group-hover:text-blue-500">
                                    {activePlan.name} <Icon name="chevron-down" size={14} />
                                </h1>
                                <span className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">{workDays} AT ({monthSollBase.toFixed(1)}h)</span>
                            </div>
                        </div>

                        <div className="flex items-center gap-2">
                            {/* Nav */}
                            <div className={`flex items-center p-1 rounded-xl border ${isDarkMode ? 'bg-black/40 border-white/5' : 'bg-slate-100 border-slate-200'}`}>
                                <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-1 hover:bg-slate-500/20 rounded-lg"><Icon name="chevron-left" size={16}/></button>
                                <div className="px-3 font-bold text-[11px] uppercase min-w-[120px] text-center">{currentDate.toLocaleString('de-DE', { month: 'long', year: 'numeric' })}</div>
                                <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-1 hover:bg-slate-500/20 rounded-lg"><Icon name="chevron-right" size={16}/></button>
                            </div>

                            {/* Tools */}
                            <div className="flex items-center gap-1">
                                <button onClick={() => setViewMode(viewMode === 'month' ? 'week' : 'month')} className={`p-2 rounded-xl border transition-all ${isDarkMode ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200'} hover:bg-blue-500/10`} title="Ansicht wechseln">
                                    <Icon name={viewMode === 'month' ? "layout" : "columns"} />
                                </button>
                                <button onClick={() => window.print()} className={`p-2 rounded-xl border transition-all ${isDarkMode ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200'}`} title="Drucken">
                                    <Icon name="printer" />
                                </button>
                                <button onClick={() => setIsAiModalOpen(true)} className={`p-2 rounded-xl border border-blue-500/30 bg-blue-500/10 text-blue-500 transition-all hover:bg-blue-500/20`} title="KI-Assistent">
                                    <Icon name="sparkles" />
                                </button>
                                <div className="w-px h-6 bg-slate-500/20 mx-1"></div>
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-2 rounded-xl border border-white/10"><Icon name={isDarkMode ? "sun" : "moon"} /></button>
                                <button onClick={() => setIsEditMode(!isEditMode)} className={`p-2 rounded-xl border ${isEditMode ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-white/10'}`}><Icon name={isEditMode ? "unlock" : "lock"} /></button>
                                <button onClick={() => setIsSettingsOpen(true)} className="p-2 rounded-xl border border-white/10"><Icon name="settings" /></button>
                                <button onClick={exportData} className="p-2 rounded-xl border border-white/10" title="Export"><Icon name="download" /></button>
                            </div>
                        </div>
                    </header>

                    <div className="flex flex-1 gap-4 overflow-hidden relative">
                        {/* Sidebar Palette */}
                        <aside className="w-14 md:w-48 flex flex-col gap-3 no-print shrink-0">
                            <div className={`p-3 rounded-[24px] border flex-1 overflow-y-auto custom-scrollbar ${cardClasses}`}>
                                <p className="text-[10px] font-black text-slate-500 mb-3 uppercase tracking-widest hidden md:block">Dienste</p>
                                <div className="flex flex-col gap-2">
                                    {Object.entries(shifts).map(([key, cfg]) => (
                                        <button key={key} onClick={() => setActiveShift(key)} className={`flex items-center gap-3 p-2 rounded-xl border transition-all ${activeShift === key ? 'bg-blue-600/20 border-blue-500 scale-105 shadow-lg' : isDarkMode ? 'bg-black/20 border-white/5' : 'bg-slate-50 border-slate-200'}`}>
                                            <div className={`w-8 h-8 rounded-lg ${cfg.color} flex items-center justify-center text-[10px] font-black ${cfg.textColor} shrink-0`}>{key}</div>
                                            <span className="text-[10px] font-black hidden md:block uppercase truncate">{cfg.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className={`p-3 rounded-[24px] border ${cardClasses} hidden md:block`}>
                                <div className="flex items-center gap-2 mb-2">
                                    <Icon name="zoom-in" size={12} className="text-slate-500" />
                                    <input type="range" min="0.5" max="1.5" step="0.1" value={zoom} onChange={(e) => setZoom(e.target.value)} className="w-full accent-blue-600" />
                                </div>
                            </div>
                        </aside>

                        {/* Roster Table */}
                        <main className={`flex-1 rounded-[24px] overflow-hidden flex flex-col border relative ${cardClasses}`}>
                            <div className="overflow-auto flex-1 custom-scrollbar">
                                <div style={{ transform: `scale(${zoom})`, transformOrigin: 'top left', width: `${100/zoom}%` }}>
                                    <table className="w-full border-separate border-spacing-0">
                                        <thead>
                                            <tr className="sticky top-0 z-[70] bg-[#0f172a] text-white">
                                                <th className="p-3 text-left text-[10px] font-black border-b border-white/10 sticky left-0 z-[80] bg-[#0f172a] min-w-[180px] uppercase">Personal</th>
                                                <th className="p-2 text-center text-[9px] font-black border-b border-white/10 uppercase opacity-60">Soll</th>
                                                <th className="p-2 text-center text-[9px] font-black border-b border-white/10 uppercase opacity-60">Ist</th>
                                                <th className="p-2 text-center text-[9px] font-black border-b border-white/10 uppercase opacity-60">+/-</th>
                                                {visibleDays.map(day => {
                                                    const k = day.toISOString().split('T')[0];
                                                    const isH = !!holidays[k];
                                                    return (
                                                        <th key={k} className={`p-2 border-b border-white/10 min-w-[50px] ${isH ? 'bg-amber-500/20' : ''}`}>
                                                            <div className="flex flex-col items-center">
                                                                <span className="text-[8px] uppercase font-bold opacity-40">{day.toLocaleDateString('de-DE', { weekday: 'short' })}</span>
                                                                <span className={`text-xs font-black ${isH ? 'text-amber-500' : ''}`}>{day.getDate()}</span>
                                                            </div>
                                                        </th>
                                                    );
                                                })}
                                            </tr>
                                        </thead>
                                        <tbody className={`divide-y ${isDarkMode ? 'divide-white/5' : 'divide-slate-200'}`}>
                                            {employees.map((emp, rIdx) => {
                                                const empSoll = monthSollBase * (parseFloat(emp.status) / 100);
                                                const empRost = roster[emp.id] || {};
                                                const ist = Object.values(empRost).reduce((acc, code) => acc + (shifts[code]?.hours || 0), 0);
                                                const diff = ist - empSoll;

                                                return (
                                                    <tr key={emp.id} className="hover:bg-blue-500/5 transition-colors">
                                                        <td className="p-3 sticky left-0 z-40 bg-[#0f172a] text-white border-r border-white/5">
                                                            <div className="font-black text-[11px] uppercase truncate">{emp.name}</div>
                                                            <div className="text-[8px] opacity-60 uppercase">{emp.role}</div>
                                                        </td>
                                                        <td className="p-2 text-center text-[10px] font-mono opacity-50">{empSoll.toFixed(0)}</td>
                                                        <td className="p-2 text-center text-[10px] font-black">{ist.toFixed(0)}</td>
                                                        <td className={`p-2 text-center text-[10px] font-black ${diff >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>{diff.toFixed(0)}</td>
                                                        
                                                        {visibleDays.map(day => {
                                                            const k = day.toISOString().split('T')[0];
                                                            const s = empRost[k];
                                                            const violations = checkViolations(emp.id, day, activeShift);
                                                            const isH = !!holidays[k];
                                                            
                                                            return (
                                                                <td key={k} onClick={() => toggleShift(emp.id, day)} className={`p-1 border-r ${isDarkMode ? 'border-white/[0.02]' : 'border-slate-100'} cursor-pointer relative`}>
                                                                    <div className={`shift-cell rounded-lg flex flex-col items-center justify-center ${s ? `${shifts[s]?.color} ${shifts[s]?.textColor} shadow-md` : ''}`}>
                                                                        <span className="text-[10px] font-black">{s || ''}</span>
                                                                        {isEditMode && !s && violations.length > 0 && (
                                                                            <div className="absolute top-0 right-0 p-0.5" title={violations.join("\n")}>
                                                                                <Icon name="alert-circle" size={10} className="text-rose-500" />
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </td>
                                                            );
                                                        })}
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </main>
                    </div>

                    {/* PLAN MANAGER MODAL */}
                    {isPlanManagerOpen && (
                        <div className="fixed inset-0 z-[600] flex items-center justify-center p-4 backdrop-blur-md">
                            <div className="absolute inset-0 bg-black/60" onClick={() => setIsPlanManagerOpen(false)}></div>
                            <div className={`relative ${isDarkMode ? 'bg-[#0f172a] border-white/10 text-white' : 'bg-white border-slate-200 text-slate-900'} border rounded-[32px] w-full max-w-lg p-8 shadow-2xl`}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-black uppercase tracking-tighter">Plan-Management</h2>
                                    <button onClick={() => setIsPlanManagerOpen(false)}><Icon name="x"/></button>
                                </div>
                                <div className="space-y-3 max-h-[400px] overflow-auto custom-scrollbar pr-2 mb-6">
                                    {Object.entries(plans).map(([id, p]) => (
                                        <div key={id} className={`flex items-center justify-between p-4 rounded-2xl border transition-all ${activePlanId === id ? 'bg-blue-600 border-blue-500 text-white' : 'bg-white/5 border-white/5 hover:bg-white/10'}`}>
                                            <div onClick={() => { setActivePlanId(id); setIsPlanManagerOpen(false); }} className="flex-1 cursor-pointer">
                                                <input 
                                                    className="bg-transparent font-black uppercase text-sm border-none outline-none w-full" 
                                                    value={p.name} 
                                                    onChange={(e) => setPlans(prev => ({ ...prev, [id]: { ...prev[id], name: e.target.value } }))}
                                                />
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => duplicatePlan(id)} className="p-2 hover:bg-white/20 rounded-lg"><Icon name="copy" size={14}/></button>
                                                <button onClick={() => deletePlan(id)} className="p-2 hover:bg-rose-500/20 text-rose-500 rounded-lg"><Icon name="trash-2" size={14}/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={createNewPlan} className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs shadow-lg shadow-blue-600/20">Neuer Plan erstellen</button>
                                    <label className="flex-1 py-4 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs shadow-lg shadow-emerald-600/20 text-center cursor-pointer">
                                        Import (.json)
                                        <input type="file" className="hidden" accept=".json" onChange={importData} />
                                    </label>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI ASSISTANT MODAL (MODERN) */}
                    {isAiModalOpen && (
                        <div className="fixed inset-0 z-[600] flex items-center justify-center p-4 backdrop-blur-md">
                            <div className="absolute inset-0 bg-black/60" onClick={() => setIsAiModalOpen(false)}></div>
                            <div className={`relative ${isDarkMode ? 'bg-[#0f172a] border-white/10 text-white' : 'bg-white border-slate-200 text-slate-900'} border rounded-[32px] w-full max-w-2xl p-8 shadow-2xl flex flex-col max-h-[90vh]`}>
                                <h2 className="text-2xl font-black uppercase mb-6 flex items-center gap-3"><span className="text-blue-500">✨</span> KI-Planungsassistent</h2>
                                <div className="flex-1 space-y-4 overflow-auto pr-2 custom-scrollbar">
                                    <button className="w-full p-6 rounded-2xl bg-blue-600/10 border border-blue-500/20 text-left hover:bg-blue-600/20 transition-all flex items-center justify-between">
                                        <div>
                                            <p className="font-black uppercase text-xs text-blue-500 mb-1 tracking-widest">Tausch-Assistent</p>
                                            <p className="text-sm opacity-80">Wer kann am 15.04. für Hendrik einspringen?</p>
                                        </div>
                                        <Icon name="arrow-right" />
                                    </button>
                                    <button className="w-full p-6 rounded-2xl bg-emerald-600/10 border border-emerald-500/20 text-left hover:bg-emerald-600/20 transition-all flex items-center justify-between">
                                        <div>
                                            <p className="font-black uppercase text-xs text-emerald-500 mb-1 tracking-widest">Plan-Audit</p>
                                            <p className="text-sm opacity-80">Prüfe den gesamten Monat auf AZG-Verstöße und Fairness.</p>
                                        </div>
                                        <Icon name="shield-check" />
                                    </button>
                                    <div className="p-6 bg-slate-500/10 rounded-2xl italic text-xs opacity-60">
                                        Die KI-Features benötigen einen aktiven Gemini-API-Key. Der Tausch-Assistent prüft automatisch Ruhezeiten und Überstundenkonten.
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <style>{`
                        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                        .animate-spin-slow { animation: spin-slow 8s linear infinite; }
                    `}</style>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
